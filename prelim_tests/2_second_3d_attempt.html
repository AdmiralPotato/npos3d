<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="Admiral's Hands">
<title></title>
<style>
*{
	margin: 0px;
	padding: 0px;
	border: 0px;
	outline: 0px;
}
html,body,#canvas{
height: 100%;
width: 100%;
}
body{
	background-color: #000;
}
#canvas{
	position: fixed;
}
#controls{
	position: absolute;
	top: 0px;
	left: 0px;
	padding: 16px;
	background-color: rgba(255,255,255,0.1);
	color: #9f0;
	font-size: 12px;
	line-height: 16px;
	font-family: monospace;
	white-space: pre-wrap;
}
</style>
</head>
<body><canvas id="canvas"></canvas>
<div id="controls">The following controls do things:
Arrows: move your ship
Space: Fire a bullet
1: Plant a tree
2: Plant a different tree
2: Plant a car
4: Change ship type
-
Mouse controlls the camera X and Y
Scrolling controlls camera Z
</div>
<script>
//--------------------------------
//Basic scene setup
//--------------------------------

var canvas = document.getElementById('canvas');
var c = canvas.getContext('2d');
var w=0,h=0,cx=0,cy=0,wph=0;
var pi = Math.PI;
var tau = pi * 2;

//Field Of View; Important!
var fov = 550;
var clipNear = fov; //This line is also VERY important! Never have the clipNear less than the FOV!
var clipFar = -1000;

//Kind of a hack, but it works in a pinch.
var camera = [0,0,0];

//which is short for renderQueue - push ob3Ds into this to get them to show up in the scene
//invoke [ob].destroy(); to remove an ob3D from the scene.
var rQ = [];


//--------------------------------
//Basic input setup
//--------------------------------

var mpos = [0,0];
window.onmousemove = function(e){mpos=[e.clientX - cx, e.clientY - cy];}

var scroll=0;
window.onmousewheel = function(e){scroll=e.wheelDelta;}; //Chrome
window.addEventListener('DOMMouseScroll',function(e){scroll=e.detail;},false); //FireFox. Wut. You. Smokin.

var keyList = [];
keyList[32] = 'space';
keyList[38] = 'up';
keyList[40] = 'down';
keyList[37] = 'left';
keyList[39] = 'right';
keyList[49] = 'one';
keyList[50] = 'two';
keyList[51] = 'three';
keyList[52] = 'four';
var kb = {};
function setKey(e){
	if(e.type == 'keyup'){val = false;}
	else{val = true;}
	if(keyList[e.keyCode]){
		kb[keyList[e.keyCode]] = val;
	}
}
window.onkeydown = setKey;
window.onkeyup = setKey;


//--------------------------------
//This is where all of the 3D and math happens
//--------------------------------


var project3Dto2D = function(p3){
	var scale = fov/(fov + -p3[2]), p2 = {};
	p2.x = (p3[0] * scale);
	p2.y = (p3[1] * scale);
	return p2;
};

var getP3Offset = function(p3,offset){
	//a quick hack to quickly add the offset of the object
	var p3 = [p3[0]+offset[0], p3[1]+offset[1], p3[2]+offset[2]];
	return p3;
}

var drawLines = function(o){
	for(var i = 0; i < o.shape.lines.length; i += 1){
		//offset the points by the object's position
		var p3a = getP3Offset(o.shape.points[o.shape.lines[i][0]], o.pos);
		var p3b = getP3Offset(o.shape.points[o.shape.lines[i][1]], o.pos);
		//TOTALLY A HACK TO GET SOME CAMERA MOVEMENT
		var p3a = getP3Offset(p3a, [camera[0],camera[1],camera[2]]);
		var p3b = getP3Offset(p3b, [camera[0],camera[1],camera[2]]);
		//if the depths of the first and second point in the line are less than the far plane...
		if( p3a[2] < clipNear && p3b[2] < clipNear && p3a[2] > clipFar && p3b[2] > clipFar){
			var p0 = project3Dto2D(p3a);
			var p1 = project3Dto2D(p3b);
			c.beginPath();
			c.moveTo(p0.x,p0.y);
			c.lineTo(p1.x,p1.y);
			
			c.strokeStyle= o.shape.lines[i][2] || o.shape.color || '#fff';
			//c.lineWidth=2;
			c.lineCap='round';
			c.stroke();
		}
	}
}

//The only reason this isn't with the rest of the shapes is because I need to use it inside the prototype of ob3D
var cubeShape = {
	color:'#999',
	points:[
		[ 10, 10, 10],
		[ 10, 10,-10],
		[ 10,-10, 10],
		[ 10,-10,-10],
		[-10, 10, 10],
		[-10, 10,-10],
		[-10,-10, 10],
		[-10,-10,-10]
	],
	lines:[
		[0,1],
		[2,3],
		[4,5],
		[6,7],
		[3,1],
		[2,0],
		[7,5],
		[6,4],
		[5,1],
		[7,3],
		[4,0],
		[6,2]
	],
};

var ob3D = function(pos,shape){
	if(this === window){throw 'JIM TYPE ERROR'};
	this.pos = pos || [0,0,0];
	if(shape){this.shape = shape;}
	return this;
}

ob3D.prototype = {
	shape: cubeShape,
	pos:[0,0,0],
	update:function(){
		drawLines(this);
	},
	destroy:function(){
		for(var i = 0; i < rQ.length; i += 1){
			if(rQ[i] === this){
				rQ.splice(i,1);
			}
		}
	}
};

var rint = function(num){
	return Math.round(((Math.random()*2)-1)*num);
}


//--------------------------------
//Some Meshes to play with!
//--------------------------------
//I wrote this one by hand...
var shipShape = {
	points:[
		[20,0,0],
		[0,20,0],
		[-20,0,0],
		[0,-20,0],
		[40,0,0],
		[10,0,10],
		[0,10,10],
		[-10,0,10],
		[0,-10,10],
		[0,40,0],
		[-40,0,0],
		[0,-40,0],
		[0,0,-40]
	],
	lines:[
		[12,4,'#f3c'],
		[12,9,'#f3c'],
		[12,10,'#f3c'],
		[12,11,'#f3c'],
		[9,4,'#93c'],
		[10,9,'#93c'],
		[11,10,'#93c'],
		[4,11,'#93c'],

		[5,0,'#06f'],
		[6,1,'#06f'],
		[7,2,'#06f'],
		[8,3,'#06f'],
		[0,1,'#03c'],
		[1,2,'#03c'],
		[2,3,'#03c'],
		[3,0,'#03c'],
		[5,6,'#09f'],
		[6,7,'#09f'],
		[7,8,'#09f'],
		[8,5,'#09f'],
		[0,4,'#f3c'],
		[1,9,'#f3c'],
		[2,10,'#f3c'],
		[3,11,'#f3c']
	]
};
var centerPointShape = {
	color:'#0f0',
	points:[
		[10,-10,0],
		[-10,10,0],
		[10,10,0],
		[-10,-10,0]
	],
	lines:[
		[0,1],
		[2,3]
	]
};
//and I wrote another JS document to convert an OBJ file exported from Blender to generate this one.
var shapes = {
	diamondInset:{"color":"#f09","points":[[0,-50,50],[0,0,0],[0,0,100],[50,0,50],[0,50,50],[-50,0,50],[10,-20,60],[10,-10,70],[20,-10,60],[-10,-20,60],[-20,-10,60],[-10,-10,70],[-10,-10,30],[-20,-10,40],[-10,-20,40],[10,-10,30],[20,-10,40],[10,-20,40],[10,10,30],[20,10,40],[10,20,40],[-10,10,30],[-20,10,40],[-10,20,40],[-10,10,70],[-10,20,60],[-20,10,60],[10,10,70],[10,20,60],[20,10,60]],"lines":[[0,1],[0,5],[0,5],[0,2],[0,2],[0,3],[0,3],[0,1],[1,5],[1,4],[1,4],[1,3],[1,3],[1,5],[2,4],[2,4],[2,5],[2,5],[2,3],[2,3],[3,4],[3,4],[4,5],[4,5],[6,8],[6,7],[7,8],[9,10],[9,11],[10,11],[12,14],[12,13],[13,14],[15,17],[15,16],[16,17],[18,19],[18,20],[19,20],[21,23],[21,22],[22,23],[24,25],[24,26],[25,26],[27,28],[27,29],[28,29]]},
	diamondInside:{"color":"#90f","points":[[0,-50,50],[0,0,0],[0,0,100],[50,0,50],[0,50,50],[-50,0,50],[0,0,30],[-20,0,50],[0,-20,50],[0,0,70],[0,20,50],[20,0,50]],"lines":[[0,1],[0,5],[0,5],[0,2],[0,2],[0,3],[0,3],[0,1],[1,5],[1,4],[1,4],[1,3],[1,3],[1,5],[2,4],[2,4],[2,5],[2,5],[2,3],[2,3],[3,4],[3,4],[4,5],[4,5],[6,7],[6,11],[6,8],[6,10],[6,8],[6,7],[6,11],[6,10],[7,8],[7,10],[7,9],[7,9],[7,10],[7,8],[8,9],[8,9],[8,11],[8,11],[9,11],[9,10],[9,11],[9,10],[10,11],[10,11]]},
	bullet:{"color":"#0ff","points":[[0,-10,0],[0,0,-20],[10,0,0],[0,10,0],[-10,0,0]],"lines":[[0,1],[0,1],[0,4],[0,2],[0,4],[0,2],[1,3],[1,2],[1,4],[1,2],[1,4],[1,3],[2,3],[2,3],[3,4],[3,4]]},
	car:{"color":"#f00","points":[[-40,20,10],[-30,20,0],[-30,30,0],[-40,30,10],[-30,20,20],[-20,20,10],[-20,30,10],[-30,30,20],[30,30,20],[40,30,10],[40,20,10],[30,20,20],[20,30,10],[30,30,0],[30,20,0],[20,20,10],[20,-30,10],[30,-30,0],[30,-20,0],[20,-20,10],[30,-30,20],[40,-30,10],[40,-20,10],[30,-20,20],[-30,-20,20],[-20,-20,10],[-20,-30,10],[-30,-30,20],[-40,-20,10],[-30,-20,0],[-30,-30,0],[-40,-30,10],[-40,30,20],[-40,-30,20],[-30,-30,30],[-20,30,20],[-20,-30,20],[20,-30,20],[20,30,20],[30,30,30],[40,-30,20],[40,30,20],[60,20,20],[60,-20,20],[60,-20,30],[60,20,30],[50,30,30],[50,-30,30],[10,-10,60],[10,10,60],[-10,10,60],[-10,-10,60],[-50,-30,30],[-50,30,30],[-60,20,30],[-60,-20,30],[-60,-20,20],[-60,20,20],[30,-20,50],[30,20,50],[-30,-20,50],[-30,20,50],[30,-30,30],[-30,30,30],[-50,-30,20],[-50,30,20],[50,-30,20],[50,30,20]],"lines":[[0,1],[0,3],[0,4],[0,3],[0,1],[0,4],[1,5],[1,2],[1,5],[1,2],[2,6],[2,3],[2,6],[2,3],[3,7],[3,7],[4,7],[4,5],[4,5],[4,7],[5,6],[5,6],[6,7],[6,7],[8,9],[8,12],[8,11],[8,11],[8,9],[8,12],[9,10],[9,10],[9,13],[9,13],[10,14],[10,11],[10,11],[10,14],[11,15],[11,15],[12,13],[12,15],[12,13],[12,15],[13,14],[13,14],[14,15],[14,15],[16,20],[16,17],[16,19],[16,17],[16,19],[16,20],[17,21],[17,18],[17,21],[17,18],[18,22],[18,22],[18,19],[18,19],[19,23],[19,23],[20,23],[20,21],[20,23],[20,21],[21,22],[21,22],[22,23],[22,23],[24,27],[24,28],[24,27],[24,28],[24,25],[24,25],[25,26],[25,29],[25,26],[25,29],[26,27],[26,30],[26,27],[26,30],[27,31],[27,31],[28,29],[28,31],[28,31],[28,29],[29,30],[29,30],[30,31],[30,31],[32,63],[32,65],[32,65],[32,33],[32,63],[32,33],[33,64],[33,64],[33,34],[33,34],[34,63],[34,60],[34,63],[34,36],[34,62],[34,52],[34,52],[34,60],[34,62],[34,36],[35,38],[35,63],[35,38],[35,63],[35,36],[35,36],[36,37],[36,37],[37,38],[37,38],[37,62],[37,62],[38,39],[38,39],[39,62],[39,59],[39,62],[39,63],[39,46],[39,46],[39,41],[39,63],[39,59],[39,41],[40,41],[40,62],[40,66],[40,41],[40,62],[40,66],[41,67],[41,67],[42,43],[42,43],[42,67],[42,45],[42,67],[42,45],[43,66],[43,44],[43,66],[43,44],[44,47],[44,47],[44,45],[44,45],[45,46],[45,46],[46,67],[46,59],[46,47],[46,47],[46,67],[46,59],[47,62],[47,58],[47,62],[47,66],[47,58],[47,66],[48,58],[48,58],[48,49],[48,49],[48,51],[48,51],[49,59],[49,59],[49,50],[49,50],[50,51],[50,51],[50,61],[50,61],[51,60],[51,60],[52,55],[52,60],[52,60],[52,64],[52,53],[52,53],[52,64],[52,55],[53,61],[53,65],[53,54],[53,65],[53,54],[53,61],[53,63],[53,63],[54,57],[54,55],[54,57],[54,55],[55,56],[55,56],[56,57],[56,64],[56,57],[56,64],[57,65],[57,65],[58,62],[58,62],[58,60],[58,59],[58,59],[58,60],[59,61],[59,61],[60,61],[60,61],[61,63],[61,63],[64,65],[64,65],[66,67],[66,67]]},
	treeRect:{"color":"#0a0","points":[[-20,-20,0],[20,-20,0],[20,20,0],[-20,20,0],[10,10,40],[-10,10,40],[10,-10,40],[-10,-10,40],[0,0,110],[-20,-20,90],[-20,20,90],[20,20,90],[20,-20,90],[-30,-30,70],[-30,30,70],[30,30,70],[30,-30,70],[-20,-20,40],[20,-20,40],[20,20,40],[-20,20,40]],"lines":[[0,7],[0,1],[0,7],[0,3],[0,1],[0,3],[1,6],[1,6],[1,2],[1,2],[2,4],[2,3],[2,4],[2,3],[3,5],[3,5],[4,19],[4,6],[4,19],[4,6],[4,5],[4,5],[5,20],[5,7],[5,20],[5,7],[6,7],[6,18],[6,7],[6,18],[7,17],[7,17],[8,10],[8,9],[8,10],[8,9],[8,12],[8,11],[8,11],[8,12],[9,12],[9,10],[9,13],[9,13],[9,12],[9,10],[10,14],[10,11],[10,11],[10,14],[11,15],[11,12],[11,15],[11,12],[12,16],[12,16],[13,17],[13,17],[13,14],[13,16],[13,14],[13,16],[14,20],[14,15],[14,15],[14,20],[15,19],[15,16],[15,19],[15,16],[16,18],[16,18],[17,20],[17,18],[17,18],[17,20],[18,19],[18,19],[19,20],[19,20]]},
	treeDiag:{"color":"#6a0","points":[[0,-20,0],[20,0,0],[0,20,0],[-20,0,0],[0,-10,40],[10,0,40],[0,10,40],[-10,0,40],[-20,0,40],[0,20,40],[20,0,40],[0,-20,40],[0,0,110],[0,-30,90],[-30,0,90],[0,30,90],[30,0,90],[0,-40,70],[-40,0,70],[0,40,70],[40,0,70]],"lines":[[0,4],[0,1],[0,4],[0,3],[0,3],[0,1],[1,5],[1,2],[1,5],[1,2],[2,6],[2,6],[2,3],[2,3],[3,7],[3,7],[4,5],[4,7],[4,5],[4,11],[4,11],[4,7],[5,10],[5,6],[5,6],[5,10],[6,7],[6,9],[6,7],[6,9],[7,8],[7,8],[8,9],[8,9],[8,11],[8,11],[8,18],[8,18],[9,19],[9,10],[9,19],[9,10],[10,20],[10,11],[10,11],[10,20],[11,17],[11,17],[12,13],[12,16],[12,15],[12,14],[12,15],[12,14],[12,13],[12,16],[13,14],[13,16],[13,17],[13,17],[13,16],[13,14],[14,15],[14,18],[14,15],[14,18],[15,16],[15,19],[15,19],[15,16],[16,20],[16,20],[17,20],[17,18],[17,20],[17,18],[18,19],[18,19],[19,20],[19,20]]},
	plane:{"color":"#f00","points":[[-2000,0,0],[-1000,0,0],[-1200,0,0],[-1400,0,0],[-1600,0,0],[-1800,0,0],[-2000,-200,0],[-2000,-400,0],[-2000,-600,0],[-2000,-800,0],[-2000,-1000,0],[-2000,-1200,0],[-2000,-1400,0],[-2000,-1600,0],[-2000,-1800,0],[-2000,-2000,0],[0,-2000,0],[-200,-2000,0],[-400,-2000,0],[-600,-2000,0],[-800,-2000,0],[-1000,-2000,0],[-1200,-2000,0],[-1400,-2000,0],[-1600,-2000,0],[-1800,-2000,0],[0,-1800,0],[-200,-1800,0],[-400,-1800,0],[-600,-1800,0],[-800,-1800,0],[-1000,-1800,0],[-1200,-1800,0],[-1400,-1800,0],[-1600,-1800,0],[-1800,-1800,0],[0,-1600,0],[-200,-1600,0],[-400,-1600,0],[-600,-1600,0],[-800,-1600,0],[-1000,-1600,0],[-1200,-1600,0],[-1400,-1600,0],[-1600,-1600,0],[-1800,-1600,0],[0,-1400,0],[-200,-1400,0],[-400,-1400,0],[-600,-1400,0],[-800,-1400,0],[-1000,-1400,0],[-1200,-1400,0],[-1400,-1400,0],[-1600,-1400,0],[-1800,-1400,0],[-200,-1200,0],[-400,-1200,0],[-600,-1200,0],[-800,-1200,0],[-1000,-1200,0],[-1200,-1200,0],[-1400,-1200,0],[-1600,-1200,0],[-1800,-1200,0],[-200,-1000,0],[-400,-1000,0],[-600,-1000,0],[-800,-1000,0],[-1000,-1000,0],[-1200,-1000,0],[-1400,-1000,0],[-1600,-1000,0],[-1800,-1000,0],[0,-800,0],[-200,-800,0],[-400,-800,0],[-600,-800,0],[-800,-800,0],[-1000,-800,0],[-1200,-800,0],[-1400,-800,0],[-1600,-800,0],[-1800,-800,0],[0,-600,0],[-200,-600,0],[-400,-600,0],[-600,-600,0],[-800,-600,0],[-1000,-600,0],[-1200,-600,0],[-1400,-600,0],[-1600,-600,0],[-1800,-600,0],[0,-400,0],[-200,-400,0],[-400,-400,0],[-600,-400,0],[-800,-400,0],[-1000,-400,0],[-1200,-400,0],[-1400,-400,0],[-1600,-400,0],[-1800,-400,0],[0,-200,0],[-200,-200,0],[-400,-200,0],[-600,-200,0],[-800,-200,0],[-1000,-200,0],[-1200,-200,0],[-1400,-200,0],[-1600,-200,0],[-1800,-200,0],[200,-200,0],[400,-200,0],[600,-200,0],[800,-200,0],[1000,-200,0],[1200,-200,0],[1400,-200,0],[1600,-200,0],[1800,-200,0],[2000,-200,0],[200,-400,0],[400,-400,0],[600,-400,0],[800,-400,0],[1000,-400,0],[1200,-400,0],[1400,-400,0],[1600,-400,0],[1800,-400,0],[2000,-400,0],[200,-600,0],[400,-600,0],[600,-600,0],[800,-600,0],[1000,-600,0],[1200,-600,0],[1400,-600,0],[1600,-600,0],[1800,-600,0],[2000,-600,0],[200,-800,0],[400,-800,0],[600,-800,0],[800,-800,0],[1000,-800,0],[1200,-800,0],[1400,-800,0],[1600,-800,0],[1800,-800,0],[2000,-800,0],[200,-1000,0],[400,-1000,0],[600,-1000,0],[800,-1000,0],[1000,-1000,0],[1200,-1000,0],[1400,-1000,0],[1600,-1000,0],[1800,-1000,0],[2000,-1000,0],[200,-1200,0],[400,-1200,0],[600,-1200,0],[800,-1200,0],[1000,-1200,0],[1200,-1200,0],[1400,-1200,0],[1600,-1200,0],[1800,-1200,0],[2000,-1200,0],[200,-1400,0],[400,-1400,0],[600,-1400,0],[800,-1400,0],[1000,-1400,0],[1200,-1400,0],[1400,-1400,0],[1600,-1400,0],[1800,-1400,0],[2000,-1400,0],[200,-1600,0],[400,-1600,0],[600,-1600,0],[800,-1600,0],[1000,-1600,0],[1200,-1600,0],[1400,-1600,0],[1600,-1600,0],[1800,-1600,0],[2000,-1600,0],[200,-1800,0],[400,-1800,0],[600,-1800,0],[800,-1800,0],[1000,-1800,0],[1200,-1800,0],[1400,-1800,0],[1600,-1800,0],[1800,-1800,0],[2000,-1800,0],[200,-2000,0],[400,-2000,0],[600,-2000,0],[800,-2000,0],[1000,-2000,0],[1200,-2000,0],[1400,-2000,0],[1600,-2000,0],[1800,-2000,0],[2000,-2000,0],[0,-1200,0],[0,-1000,0],[200,0,0],[1000,0,0],[1200,0,0],[1400,0,0],[1600,0,0],[1800,0,0],[0,2000,0],[2000,2000,0],[1800,2000,0],[1600,2000,0],[1400,2000,0],[1200,2000,0],[1000,2000,0],[800,2000,0],[600,2000,0],[400,2000,0],[200,2000,0],[0,1800,0],[0,1600,0],[0,1200,0],[0,800,0],[0,400,0],[0,200,0],[2000,0,0],[800,0,0],[600,0,0],[400,0,0],[2000,200,0],[1800,200,0],[1600,200,0],[1400,200,0],[1200,200,0],[1000,200,0],[800,200,0],[600,200,0],[400,200,0],[200,200,0],[2000,400,0],[1800,400,0],[1600,400,0],[1400,400,0],[1200,400,0],[1000,400,0],[800,400,0],[600,400,0],[400,400,0],[200,400,0],[2000,600,0],[1800,600,0],[1600,600,0],[1400,600,0],[1200,600,0],[1000,600,0],[800,600,0],[600,600,0],[400,600,0],[200,600,0],[2000,800,0],[1800,800,0],[1600,800,0],[1400,800,0],[1200,800,0],[1000,800,0],[800,800,0],[600,800,0],[400,800,0],[200,800,0],[2000,1000,0],[1800,1000,0],[1600,1000,0],[1400,1000,0],[1200,1000,0],[1000,1000,0],[800,1000,0],[600,1000,0],[400,1000,0],[200,1000,0],[2000,1200,0],[1800,1200,0],[1600,1200,0],[1400,1200,0],[1200,1200,0],[1000,1200,0],[800,1200,0],[600,1200,0],[400,1200,0],[200,1200,0],[2000,1400,0],[1800,1400,0],[1600,1400,0],[1400,1400,0],[1200,1400,0],[1000,1400,0],[800,1400,0],[600,1400,0],[400,1400,0],[200,1400,0],[2000,1600,0],[1800,1600,0],[1600,1600,0],[1400,1600,0],[1200,1600,0],[1000,1600,0],[800,1600,0],[600,1600,0],[400,1600,0],[200,1600,0],[2000,1800,0],[1800,1800,0],[1600,1800,0],[1400,1800,0],[1200,1800,0],[1000,1800,0],[800,1800,0],[600,1800,0],[400,1800,0],[200,1800,0],[-1800,1800,0],[-1600,1800,0],[-1400,1800,0],[-1200,1800,0],[-1000,1800,0],[-800,1800,0],[-600,1800,0],[-400,1800,0],[-200,1800,0],[-1800,1600,0],[-1600,1600,0],[-1400,1600,0],[-1200,1600,0],[-1000,1600,0],[-800,1600,0],[-600,1600,0],[-400,1600,0],[-200,1600,0],[-1800,1400,0],[-1600,1400,0],[-1400,1400,0],[-1200,1400,0],[-1000,1400,0],[-800,1400,0],[-600,1400,0],[-400,1400,0],[-200,1400,0],[0,1400,0],[-1800,1200,0],[-1600,1200,0],[-1400,1200,0],[-1200,1200,0],[-1000,1200,0],[-800,1200,0],[-600,1200,0],[-400,1200,0],[-200,1200,0],[-1800,1000,0],[-1600,1000,0],[-1400,1000,0],[-1200,1000,0],[-1000,1000,0],[-800,1000,0],[-600,1000,0],[-400,1000,0],[-200,1000,0],[0,1000,0],[-1800,800,0],[-1600,800,0],[-1400,800,0],[-1200,800,0],[-1000,800,0],[-800,800,0],[-600,800,0],[-400,800,0],[-200,800,0],[-1800,600,0],[-1600,600,0],[-1400,600,0],[-1200,600,0],[-1000,600,0],[-800,600,0],[-600,600,0],[-400,600,0],[-200,600,0],[0,600,0],[-1800,400,0],[-1600,400,0],[-1400,400,0],[-1200,400,0],[-1000,400,0],[-800,400,0],[-600,400,0],[-400,400,0],[-200,400,0],[-1800,200,0],[-1600,200,0],[-1400,200,0],[-1200,200,0],[-1000,200,0],[-800,200,0],[-600,200,0],[-400,200,0],[-200,200,0],[-800,0,0],[-600,0,0],[-400,0,0],[-200,0,0],[0,0,0],[-2000,200,0],[-2000,400,0],[-2000,600,0],[-2000,800,0],[-2000,1000,0],[-2000,1200,0],[-2000,1400,0],[-2000,1600,0],[-2000,1800,0],[-1800,2000,0],[-1600,2000,0],[-1400,2000,0],[-1200,2000,0],[-1000,2000,0],[-800,2000,0],[-600,2000,0],[-400,2000,0],[-200,2000,0],[-2000,2000,0]],"lines":[[0,6],[0,5],[0,5],[0,422],[1,109],[1,109],[1,417],[1,417],[1,2],[1,412],[1,2],[1,412],[2,110],[2,411],[2,3],[2,411],[2,110],[2,3],[3,111],[3,410],[3,4],[3,111],[3,4],[3,410],[4,5],[4,409],[4,409],[4,112],[4,5],[4,112],[5,113],[5,408],[5,113],[5,408],[6,113],[6,113],[6,7],[7,8],[7,103],[7,103],[8,9],[8,93],[8,93],[9,10],[9,83],[9,83],[10,73],[10,73],[10,11],[11,64],[11,64],[11,12],[12,13],[12,55],[12,55],[13,45],[13,14],[13,45],[14,35],[14,15],[14,35],[15,25],[16,26],[16,204],[16,26],[16,17],[17,27],[17,27],[17,18],[18,19],[18,28],[18,28],[19,29],[19,20],[19,29],[20,21],[20,30],[20,30],[21,31],[21,31],[21,22],[22,32],[22,23],[22,32],[23,24],[23,33],[23,33],[24,34],[24,25],[24,34],[25,35],[25,35],[26,27],[26,36],[26,194],[26,27],[26,36],[26,194],[27,28],[27,37],[27,28],[27,37],[28,29],[28,38],[28,29],[28,38],[29,39],[29,30],[29,30],[29,39],[30,40],[30,31],[30,31],[30,40],[31,32],[31,41],[31,32],[31,41],[32,42],[32,33],[32,42],[32,33],[33,43],[33,34],[33,43],[33,34],[34,44],[34,44],[34,35],[34,35],[35,45],[35,45],[36,184],[36,37],[36,184],[36,46],[36,46],[36,37],[37,38],[37,38],[37,47],[37,47],[38,39],[38,39],[38,48],[38,48],[39,49],[39,49],[39,40],[39,40],[40,50],[40,41],[40,50],[40,41],[41,42],[41,51],[41,51],[41,42],[42,43],[42,52],[42,43],[42,52],[43,53],[43,44],[43,53],[43,44],[44,45],[44,54],[44,54],[44,45],[45,55],[45,55],[46,47],[46,174],[46,214],[46,214],[46,174],[46,47],[47,56],[47,48],[47,56],[47,48],[48,57],[48,57],[48,49],[48,49],[49,58],[49,58],[49,50],[49,50],[50,51],[50,51],[50,59],[50,59],[51,60],[51,60],[51,52],[51,52],[52,61],[52,61],[52,53],[52,53],[53,62],[53,62],[53,54],[53,54],[54,63],[54,55],[54,63],[54,55],[55,64],[55,64],[56,65],[56,214],[56,214],[56,57],[56,57],[56,65],[57,66],[57,66],[57,58],[57,58],[58,59],[58,67],[58,67],[58,59],[59,68],[59,60],[59,68],[59,60],[60,69],[60,69],[60,61],[60,61],[61,62],[61,70],[61,62],[61,70],[62,71],[62,63],[62,71],[62,63],[63,72],[63,64],[63,64],[63,72],[64,73],[64,73],[65,75],[65,215],[65,66],[65,66],[65,215],[65,75],[66,76],[66,67],[66,76],[66,67],[67,68],[67,77],[67,77],[67,68],[68,69],[68,69],[68,78],[68,78],[69,79],[69,79],[69,70],[69,70],[70,71],[70,80],[70,80],[70,71],[71,72],[71,72],[71,81],[71,81],[72,82],[72,82],[72,73],[72,73],[73,83],[73,83],[74,144],[74,75],[74,215],[74,144],[74,84],[74,75],[74,215],[74,84],[75,85],[75,76],[75,76],[75,85],[76,77],[76,86],[76,77],[76,86],[77,78],[77,87],[77,87],[77,78],[78,88],[78,79],[78,79],[78,88],[79,89],[79,89],[79,80],[79,80],[80,90],[80,90],[80,81],[80,81],[81,91],[81,82],[81,91],[81,82],[82,92],[82,83],[82,83],[82,92],[83,93],[83,93],[84,94],[84,94],[84,134],[84,85],[84,85],[84,134],[85,86],[85,95],[85,86],[85,95],[86,96],[86,96],[86,87],[86,87],[87,88],[87,97],[87,97],[87,88],[88,98],[88,98],[88,89],[88,89],[89,99],[89,90],[89,99],[89,90],[90,100],[90,100],[90,91],[90,91],[91,92],[91,101],[91,101],[91,92],[92,102],[92,93],[92,102],[92,93],[93,103],[93,103],[94,124],[94,95],[94,104],[94,104],[94,124],[94,95],[95,96],[95,105],[95,105],[95,96],[96,97],[96,106],[96,106],[96,97],[97,107],[97,107],[97,98],[97,98],[98,99],[98,108],[98,108],[98,99],[99,109],[99,100],[99,100],[99,109],[100,110],[100,101],[100,110],[100,101],[101,111],[101,111],[101,102],[101,102],[102,103],[102,112],[102,112],[102,103],[103,113],[103,113],[104,105],[104,114],[104,421],[104,421],[104,105],[104,114],[105,420],[105,106],[105,106],[105,420],[106,419],[106,107],[106,419],[106,107],[107,418],[107,418],[107,108],[107,108],[108,109],[108,109],[108,417],[108,417],[109,110],[109,110],[110,111],[110,111],[111,112],[111,112],[112,113],[112,113],[114,216],[114,124],[114,216],[114,115],[114,115],[114,124],[115,116],[115,242],[115,125],[115,242],[115,116],[115,125],[116,126],[116,241],[116,241],[116,117],[116,126],[116,117],[117,118],[117,127],[117,118],[117,240],[117,127],[117,240],[118,128],[118,119],[118,128],[118,217],[118,119],[118,217],[119,129],[119,120],[119,218],[119,218],[119,120],[119,129],[120,130],[120,121],[120,130],[120,219],[120,219],[120,121],[121,122],[121,220],[121,131],[121,122],[121,131],[121,220],[122,123],[122,132],[122,221],[122,221],[122,132],[122,123],[123,133],[123,239],[124,134],[124,125],[124,134],[124,125],[125,126],[125,135],[125,126],[125,135],[126,127],[126,136],[126,136],[126,127],[127,128],[127,137],[127,128],[127,137],[128,138],[128,129],[128,129],[128,138],[129,130],[129,139],[129,130],[129,139],[130,140],[130,131],[130,131],[130,140],[131,132],[131,141],[131,132],[131,141],[132,142],[132,142],[132,133],[132,133],[133,143],[134,135],[134,135],[134,144],[134,144],[135,145],[135,145],[135,136],[135,136],[136,137],[136,146],[136,137],[136,146],[137,138],[137,147],[137,147],[137,138],[138,139],[138,148],[138,148],[138,139],[139,140],[139,149],[139,140],[139,149],[140,150],[140,150],[140,141],[140,141],[141,151],[141,142],[141,142],[141,151],[142,152],[142,143],[142,143],[142,152],[143,153],[144,154],[144,145],[144,145],[144,154],[145,155],[145,155],[145,146],[145,146],[146,156],[146,147],[146,147],[146,156],[147,148],[147,157],[147,148],[147,157],[148,158],[148,149],[148,149],[148,158],[149,150],[149,159],[149,159],[149,150],[150,160],[150,151],[150,151],[150,160],[151,161],[151,152],[151,152],[151,161],[152,162],[152,153],[152,162],[152,153],[153,163],[154,164],[154,164],[154,215],[154,215],[154,155],[154,155],[155,165],[155,156],[155,156],[155,165],[156,166],[156,157],[156,157],[156,166],[157,167],[157,167],[157,158],[157,158],[158,159],[158,168],[158,168],[158,159],[159,160],[159,169],[159,160],[159,169],[160,170],[160,161],[160,170],[160,161],[161,171],[161,171],[161,162],[161,162],[162,163],[162,172],[162,163],[162,172],[163,173],[164,214],[164,174],[164,165],[164,174],[164,214],[164,165],[165,175],[165,166],[165,175],[165,166],[166,176],[166,167],[166,167],[166,176],[167,177],[167,177],[167,168],[167,168],[168,178],[168,169],[168,178],[168,169],[169,179],[169,179],[169,170],[169,170],[170,171],[170,171],[170,180],[170,180],[171,172],[171,181],[171,172],[171,181],[172,182],[172,182],[172,173],[172,173],[173,183],[174,184],[174,184],[174,175],[174,175],[175,176],[175,185],[175,176],[175,185],[176,177],[176,186],[176,177],[176,186],[177,187],[177,178],[177,187],[177,178],[178,188],[178,179],[178,188],[178,179],[179,180],[179,180],[179,189],[179,189],[180,190],[180,181],[180,181],[180,190],[181,191],[181,182],[181,191],[181,182],[182,183],[182,192],[182,183],[182,192],[183,193],[184,194],[184,185],[184,194],[184,185],[185,195],[185,186],[185,186],[185,195],[186,196],[186,187],[186,187],[186,196],[187,197],[187,188],[187,188],[187,197],[188,198],[188,189],[188,198],[188,189],[189,199],[189,190],[189,190],[189,199],[190,191],[190,200],[190,200],[190,191],[191,192],[191,201],[191,201],[191,192],[192,202],[192,193],[192,202],[192,193],[193,203],[194,195],[194,204],[194,195],[194,204],[195,196],[195,205],[195,196],[195,205],[196,206],[196,197],[196,197],[196,206],[197,198],[197,207],[197,198],[197,207],[198,199],[198,208],[198,199],[198,208],[199,200],[199,209],[199,200],[199,209],[200,210],[200,210],[200,201],[200,201],[201,202],[201,211],[201,211],[201,202],[202,212],[202,212],[202,203],[202,203],[203,213],[204,205],[205,206],[206,207],[207,208],[208,209],[209,210],[210,211],[211,212],[212,213],[214,215],[214,215],[216,252],[216,242],[216,252],[216,242],[216,421],[216,421],[217,240],[217,218],[217,248],[217,240],[217,248],[217,218],[218,219],[218,247],[218,219],[218,247],[219,246],[219,246],[219,220],[219,220],[220,245],[220,221],[220,245],[220,221],[221,244],[221,239],[221,244],[221,239],[222,232],[222,439],[222,233],[222,233],[223,224],[223,323],[224,324],[224,324],[224,225],[225,325],[225,325],[225,226],[226,227],[226,326],[226,326],[227,228],[227,327],[227,327],[228,229],[228,328],[228,328],[229,329],[229,329],[229,230],[230,330],[230,330],[230,231],[231,331],[231,331],[231,232],[232,332],[232,332],[233,234],[233,332],[233,341],[233,332],[233,234],[233,341],[234,322],[234,350],[234,360],[234,360],[234,322],[234,350],[235,360],[235,302],[235,302],[235,369],[235,379],[235,379],[235,360],[235,369],[236,388],[236,398],[236,398],[236,379],[236,388],[236,282],[236,379],[236,282],[237,262],[237,238],[237,238],[237,398],[237,407],[237,398],[237,262],[237,407],[238,252],[238,421],[238,416],[238,416],[238,421],[238,252],[239,243],[240,241],[240,249],[240,249],[240,241],[241,250],[241,242],[241,242],[241,250],[242,251],[242,251],[243,253],[243,244],[243,244],[244,254],[244,245],[244,254],[244,245],[245,255],[245,246],[245,246],[245,255],[246,247],[246,256],[246,256],[246,247],[247,257],[247,257],[247,248],[247,248],[248,258],[248,258],[248,249],[248,249],[249,250],[249,250],[249,259],[249,259],[250,260],[250,251],[250,260],[250,251],[251,261],[251,252],[251,261],[251,252],[252,262],[252,262],[253,254],[253,254],[253,263],[254,255],[254,264],[254,255],[254,264],[255,256],[255,256],[255,265],[255,265],[256,266],[256,257],[256,257],[256,266],[257,267],[257,267],[257,258],[257,258],[258,259],[258,268],[258,259],[258,268],[259,269],[259,260],[259,269],[259,260],[260,261],[260,270],[260,270],[260,261],[261,262],[261,262],[261,271],[261,271],[262,272],[262,272],[263,264],[263,264],[263,273],[264,265],[264,274],[264,274],[264,265],[265,266],[265,275],[265,266],[265,275],[266,267],[266,276],[266,276],[266,267],[267,277],[267,268],[267,277],[267,268],[268,269],[268,278],[268,269],[268,278],[269,270],[269,270],[269,279],[269,279],[270,280],[270,271],[270,280],[270,271],[271,272],[271,281],[271,281],[271,272],[272,398],[272,282],[272,398],[272,282],[273,283],[273,274],[273,274],[274,275],[274,284],[274,284],[274,275],[275,285],[275,276],[275,285],[275,276],[276,286],[276,286],[276,277],[276,277],[277,278],[277,287],[277,287],[277,278],[278,279],[278,288],[278,288],[278,279],[279,280],[279,280],[279,289],[279,289],[280,290],[280,290],[280,281],[280,281],[281,282],[281,291],[281,291],[281,282],[282,292],[282,292],[283,293],[283,284],[283,284],[284,294],[284,285],[284,294],[284,285],[285,295],[285,295],[285,286],[285,286],[286,296],[286,287],[286,296],[286,287],[287,297],[287,297],[287,288],[287,288],[288,289],[288,289],[288,298],[288,298],[289,299],[289,299],[289,290],[289,290],[290,291],[290,300],[290,300],[290,291],[291,292],[291,301],[291,301],[291,292],[292,302],[292,302],[292,379],[292,379],[293,294],[293,303],[293,294],[294,304],[294,304],[294,295],[294,295],[295,305],[295,296],[295,296],[295,305],[296,297],[296,306],[296,297],[296,306],[297,307],[297,298],[297,307],[297,298],[298,299],[298,308],[298,299],[298,308],[299,300],[299,300],[299,309],[299,309],[300,310],[300,310],[300,301],[300,301],[301,311],[301,311],[301,302],[301,302],[302,312],[302,312],[303,304],[303,313],[303,304],[304,305],[304,305],[304,314],[304,314],[305,306],[305,315],[305,306],[305,315],[306,307],[306,316],[306,316],[306,307],[307,308],[307,308],[307,317],[307,317],[308,318],[308,318],[308,309],[308,309],[309,319],[309,310],[309,310],[309,319],[310,311],[310,311],[310,320],[310,320],[311,321],[311,321],[311,312],[311,312],[312,322],[312,360],[312,322],[312,360],[313,323],[313,314],[313,314],[314,324],[314,315],[314,315],[314,324],[315,316],[315,325],[315,325],[315,316],[316,326],[316,317],[316,326],[316,317],[317,327],[317,318],[317,318],[317,327],[318,328],[318,328],[318,319],[318,319],[319,329],[319,329],[319,320],[319,320],[320,330],[320,321],[320,330],[320,321],[321,331],[321,322],[321,322],[321,331],[322,332],[322,332],[323,324],[323,324],[324,325],[324,325],[325,326],[325,326],[326,327],[326,327],[327,328],[327,328],[328,329],[328,329],[329,330],[329,330],[330,331],[330,331],[331,332],[331,332],[333,430],[333,431],[333,334],[333,431],[333,342],[333,430],[333,334],[333,342],[334,432],[334,432],[334,343],[334,343],[334,335],[334,335],[335,433],[335,344],[335,336],[335,433],[335,344],[335,336],[336,345],[336,337],[336,337],[336,434],[336,434],[336,345],[337,346],[337,346],[337,338],[337,338],[337,435],[337,435],[338,339],[338,347],[338,347],[338,436],[338,339],[338,436],[339,340],[339,437],[339,340],[339,348],[339,348],[339,437],[340,438],[340,349],[340,349],[340,341],[340,438],[340,341],[341,439],[341,350],[341,439],[341,350],[342,429],[342,343],[342,351],[342,429],[342,343],[342,351],[343,344],[343,352],[343,344],[343,352],[344,345],[344,353],[344,345],[344,353],[345,354],[345,346],[345,346],[345,354],[346,347],[346,347],[346,355],[346,355],[347,356],[347,348],[347,348],[347,356],[348,357],[348,357],[348,349],[348,349],[349,358],[349,350],[349,358],[349,350],[350,359],[350,359],[351,361],[351,428],[351,428],[351,352],[351,352],[351,361],[352,362],[352,353],[352,353],[352,362],[353,363],[353,354],[353,354],[353,363],[354,364],[354,355],[354,355],[354,364],[355,365],[355,356],[355,365],[355,356],[356,357],[356,366],[356,366],[356,357],[357,358],[357,367],[357,367],[357,358],[358,368],[358,359],[358,368],[358,359],[359,360],[359,360],[359,369],[359,369],[361,362],[361,427],[361,370],[361,427],[361,370],[361,362],[362,371],[362,363],[362,371],[362,363],[363,372],[363,364],[363,372],[363,364],[364,365],[364,373],[364,373],[364,365],[365,374],[365,374],[365,366],[365,366],[366,375],[366,367],[366,367],[366,375],[367,376],[367,368],[367,376],[367,368],[368,369],[368,369],[368,377],[368,377],[369,378],[369,378],[370,371],[370,380],[370,426],[370,371],[370,426],[370,380],[371,381],[371,372],[371,372],[371,381],[372,382],[372,373],[372,373],[372,382],[373,374],[373,383],[373,374],[373,383],[374,375],[374,375],[374,384],[374,384],[375,376],[375,385],[375,376],[375,385],[376,377],[376,386],[376,377],[376,386],[377,378],[377,387],[377,387],[377,378],[378,379],[378,388],[378,379],[378,388],[380,389],[380,425],[380,381],[380,425],[380,389],[380,381],[381,390],[381,382],[381,390],[381,382],[382,383],[382,383],[382,391],[382,391],[383,384],[383,392],[383,392],[383,384],[384,393],[384,385],[384,393],[384,385],[385,394],[385,386],[385,394],[385,386],[386,395],[386,387],[386,387],[386,395],[387,396],[387,388],[387,396],[387,388],[388,397],[388,397],[389,390],[389,399],[389,424],[389,399],[389,424],[389,390],[390,400],[390,391],[390,400],[390,391],[391,401],[391,392],[391,401],[391,392],[392,393],[392,402],[392,393],[392,402],[393,403],[393,394],[393,394],[393,403],[394,404],[394,395],[394,395],[394,404],[395,396],[395,405],[395,405],[395,396],[396,397],[396,406],[396,406],[396,397],[397,398],[397,398],[397,407],[397,407],[399,400],[399,400],[399,408],[399,423],[399,408],[399,423],[400,409],[400,401],[400,409],[400,401],[401,402],[401,410],[401,402],[401,410],[402,411],[402,411],[402,403],[402,403],[403,404],[403,412],[403,404],[403,412],[404,405],[404,413],[404,405],[404,413],[405,414],[405,406],[405,406],[405,414],[406,415],[406,415],[406,407],[406,407],[407,416],[407,416],[408,422],[408,409],[408,409],[408,422],[409,410],[409,410],[410,411],[410,411],[411,412],[411,412],[412,413],[412,413],[413,417],[413,414],[413,414],[413,417],[414,418],[414,415],[414,418],[414,415],[415,416],[415,416],[415,419],[415,419],[416,420],[416,420],[417,418],[417,418],[418,419],[418,419],[419,420],[419,420],[420,421],[420,421],[422,423],[423,424],[424,425],[425,426],[426,427],[427,428],[428,429],[429,430],[430,440],[431,440],[431,432],[432,433],[433,434],[434,435],[435,436],[436,437],[437,438],[438,439]]}
};

//--------------------------------
//A ship that I can control
//--------------------------------

var ship = new ob3D(false,shipShape);
ship.speed = 3;
ship.vel = [0,0];
ship.drag = 0.9;
ship.rot = 0;
ship.shapeList = [
	shipShape,
	shapes.diamondInside,
	shapes.diamondInset,
];
ship.shapeState = 0;
ship.update = function(){
	var t = this;
	if(kb.left){t.vel[0]-=t.speed;}
	if(kb.right){t.vel[0]+=t.speed;}
	if(kb.up){t.vel[1]-=t.speed;}
	if(kb.down){t.vel[1]+=t.speed;}
	if(kb.space){addBullet([t.pos[0],t.pos[1],t.pos[2]]); kb.space = false;}
	if(kb.one){rQ.push(new ob3D([t.pos[0],t.pos[1],t.pos[2]],shapes.treeRect)); kb.one = false;}
	if(kb.two){rQ.push(new ob3D([t.pos[0],t.pos[1],t.pos[2]],shapes.treeDiag)); kb.two = false;}
	if(kb.three){rQ.push(new ob3D([t.pos[0],t.pos[1],t.pos[2]],shapes.car)); kb.three = false;}
	if(kb.four){
		t.shapeState += 1;
		if(t.shapeState >= t.shapeList.length){t.shapeState = 0;}
		t.shape = t.shapeList[t.shapeState];
		kb.four = false;
	}

	if(Math.abs(t.vel[0]) > 0.0001 || Math.abs(t.vel[1]) > 0.0001){
		t.pos[0] += t.vel[0];
		t.pos[1] += t.vel[1];
		t.vel[0] *= t.drag;
		t.vel[1] *= t.drag;
/*
		t.rot = Math.atan2(t.vel[0],t.vel[1]);
		if(t.pos[0] > cx + 16){t.pos[0] = -cx -16;}
		if(t.pos[0] < -cx -16){t.pos[0] = cx + 16;}
		if(t.pos[1] > cy + 16){t.pos[1] = -cy -16;}
		if(t.pos[1] < -cy -16){t.pos[1] = cy + 16;}
*/
	}
	drawLines(t);
};

rQ.push(ship);


//add a reference to the center...
var centerObj = new ob3D([0,0,-0.05],centerPointShape);
rQ.push(centerObj);

//the -0.1 is so it doesn't render overlapping anything else at z:0 accidentally.
//Why is that a problem?
//Because I'm doing z-depth based on the position of the whole object right now. :P
var plane = new ob3D([0,0,-0.1],shapes.plane);
plane.shape.color='#333';
rQ.push(plane);
//var plane = new ob3D([0,0,-400],shapes.plane);
//rQ.push(plane);
//var plane = new ob3D([0,0,-800],shapes.plane);
//rQ.push(plane);

//and 100 more at random positions
/*
for(var i = 0; i < 50; i += 1){
	rQ.push(new ob3D([rint(500),rint(500),rint(250)]));
}
*/



var addBullet = function(pos){
	var bullet = new ob3D(pos,shapes.bullet);
	bullet.update = function(){
		drawLines(this);
		this.pos[2] -= 10;
		if(this.pos[2] < clipFar){
			this.destroy();
		}
	}
	rQ.push(bullet);
};

canvas.onclick = function(){
	var pos = [mpos[0] - camera[0], mpos[1] - camera[1], -camera[2]];
	//console.log(pos);
	addBullet(pos);
};

//You'll see why this is a silly variable name in the render loop. At least it's not hammerTime.
var bulletTime = 0;


//--------------------------------
//The basic render loop
//--------------------------------

var resize = function(){
	cx=Math.floor(w/2);
	cy=Math.floor(h/2);
	mpos.x = 0;
	mpos.y = 0;
	canvas.width=w;
	canvas.height=h;
	wph=w+h;
}

var update = function(){
	w=window.innerWidth;
	h=window.innerHeight;
	if(wph != w+h){resize();}
	c.fillStyle='#rgba(0,255,0,0.4)';
	c.fillRect(0,0,w,h);
	c.save();
	//c.strokeStyle = '#fff';
	c.translate(cx,cy);

	camera[0] = mpos[0];
	camera[1] = mpos[1];
	if(scroll !== 0){camera[2] += (scroll / Math.abs(scroll)) * 50; scroll = 0;}

	//depth sorting!
	rQ.sort(function(a,b) {return a.pos[2] - b.pos[2]})

	for(var i = 0; i < rQ.length; i += 1){
		rQ[i].update();
	}

	bulletTime++;
	if(bulletTime > 10){
		bulletTime = 0;
		addBullet([rint(1000),rint(1000),500]);
	}
	
	//console.log(rQ[0].pos[0]);
	c.restore();
	setTimeout(update,1000/60);
}

update();
</script></body>
</html>